<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title %></title>
  <link rel="icon" type="image/svg+xml" href="/student-favicon.svg" />
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <%- include('../partials/header') %>

  <main class="main-content">
    <div class="community-container">
      <div class="community-header">
        <h1>Community Forum</h1>
        <p>Ask questions, share knowledge, and connect with mentors</p>
      </div>

      <div class="forum-controls">
        <% if (!isMentor) { %>
          <a href="/community/ask" class="btn btn-primary">Ask a Question</a>
        <% } %>
        <div class="forum-filters">
          <select onchange="filterForum(this.value)" class="filter-select">
            <option value="">All Careers</option>
            <option value="Web Developer">Web Developer</option>
            <option value="UI/UX Designer">UI/UX Designer</option>
            <option value="Data Analyst">Data Analyst</option>
            <option value="Cloud Engineer">Cloud Engineer</option>
            <option value="Cybersecurity Specialist">Cybersecurity Specialist</option>
            <option value="Software Tester">Software Tester</option>
            <option value="Mobile App Developer">Mobile App Developer</option>
          </select>
        </div>
      </div>

      <% if (posts.length > 0) { %>
        <div class="posts-list">
          <% posts.forEach(post => { %>
            <div class="post-card">
              <div class="post-header">
                <h3><a href="/community/post/<%= post._id %>"><%= post.title %></a></h3>
                <span class="career-badge"><%= post.careerPath %></span>
              </div>
              <p class="post-description"><%= post.description.substring(0, 150) %>...</p>
              <div class="post-meta">
                <span>By: <%= post.studentId.fullName %></span>
                <span>Views: <%= post.views %></span>
                <span>Replies: <%= post.comments.length %></span>
                <span><%= new Date(post.createdAt).toLocaleDateString() %></span>
              </div>
              <div class="post-actions">
                <a href="/community/post/<%= post._id %>" class="btn btn-secondary btn-sm">View</a>
                <% if (post.solved) { %>
                  <span class="badge badge-success">Solved</span>
                <% } %>
              </div>
            </div>
          <% }); %>
        </div>

        <!-- Pagination -->
        <% if (totalPages > 1) { %>
          <div class="pagination">
            <% if (currentPage > 1) { %>
              <a href="/community?page=1">First</a>
              <a href="/community?page=<%= currentPage - 1 %>">Previous</a>
            <% } %>
            <% for (let i = 1; i <= totalPages; i++) { %>
              <% if (i === currentPage) { %>
                <span class="page-current"><%= i %></span>
              <% } else { %>
                <a href="/community?page=<%= i %>"><%= i %></a>
              <% } %>
            <% } %>
            <% if (currentPage < totalPages) { %>
              <a href="/community?page=<%= currentPage + 1 %>">Next</a>
              <a href="/community?page=<%= totalPages %>">Last</a>
            <% } %>
          </div>
        <% } %>
      <% } else { %>
        <div class="no-posts">
          <p>No questions yet. Be the first to ask!</p>
          <a href="/community/ask" class="btn btn-primary">Ask a Question</a>
        </div>
      <% } %>
    </div>
  </main>

  <%- include('../partials/footer') %>

  <script src="/js/main.js"></script>
</body>
</html>
